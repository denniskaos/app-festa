<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#1b263b" />
  <title><%= (typeof title !== 'undefined' && title) ? `${title} · Festa da Aldeia` : 'Festa da Aldeia' %></title>

  <!-- estilos: primeiro o teu, depois o app.css responsivo -->
  <link rel="stylesheet" href="/public/css/style.css?v=1" />
<link rel="stylesheet" href="/public/app.css?v=<%= process.env.ASSET_VER || '20251017-01' %>" />

</head>
<body>

  <header class="topbar">
    <div class="container topbar-inner">
      <a href="/" class="brand" aria-label="Ir para o início">
        <img src="/public/img/logo.png" alt="Logo Festa da Aldeia" class="brand-logo" />
        <div class="brand-text">
          <span class="brand-line1">Comissão de Festas</span>
          <span class="brand-line2">em Honra de Nossa Senhora da Graça 2026 · Vila Caiz</span>
        </div>
      </a>

      <% if (user) { 
           const role = user.role || 'viewer';
      %>
        <!-- botão hambúrguer (mostra em ecrãs pequenos) -->
        <button id="nav-toggle" class="nav-toggle" aria-controls="nav-menu" aria-expanded="false" aria-label="Menu">☰</button>

        <!-- navegação -->
        <nav id="nav-menu" class="nav" aria-label="Principal">
          <!-- ITENS COMUNS A TODOS -->
          <a href="/">Painel</a>
          <a href="/movimentos">Movimentos</a>
          <a href="/jantares">Jantares</a>
          <a href="/orcamento">Orçamento</a>
          <a href="/patrocinadores">Patrocinadores</a>
          <a href="/peditorios">Peditórios</a>
          <a href="/casais">Casais</a>

          <!-- ITENS QUE O VIEWER NÃO PRECISA DE VER -->
          <% if (role !== 'viewer') { %>
            <a href="/backup">Backup</a>
            <a href="/definicoes">Definições</a>
          <% } %>

          <!-- SÓ ADMIN -->
          <% if (role === 'admin') { %>
            <a href="/utilizadores">Utilizadores</a>
          <% } %>

          <!-- sair -->
          <form action="/logout" method="post" class="nav-logout">
            <button class="btn btn-light" type="submit">Sair</button>
          </form>
        </nav>
      <% } %>
    </div>
  </header>

  <main id="conteudo" class="container page">
    <%- body %>
  </main>

  <footer class="footer">
    <div class="container">
      © <%= new Date().getFullYear() %> Comissão de Festas em Honra de Nossa Senhora da Graça 2026
    </div>
  </footer>

  <!-- JS: toggle do menu e helpers responsivos -->
  <script defer src="/public/app.js"></script>
</body>
</html>
