<div class="toolbar">
  <h1>Peditórios</h1>
</div>

<section class="card">
  <h3>Novo peditório</h3>
  <form method="post" action="/peditorios" class="form-grid">
    <label>Data
      <input type="date" name="dt" />
    </label>
    <label>Local
      <input type="text" name="local" placeholder="Rua/Bairro/Freguesia" />
    </label>
    <label>Equipa
      <input type="text" name="equipa" placeholder="(opcional)" />
    </label>
    <label>Valor (€)
      <input type="number" step="0.01" inputmode="decimal" name="valor" required />
    </label>
    <label style="grid-column:1/-1">Notas
      <input type="text" name="notas" />
    </label>
    <button class="btn">Adicionar</button>
  </form>
</section>

<div class="card">
  <h3>Lista</h3>

  <div class="table-wrap">
    <table class="table table--form table--form-manual">
      <thead>
        <tr>
          <th>Data</th>
          <th>Local</th>
          <th>Equipa</th>
          <th>Valor (€)</th>
          <th>Notas</th>
          <th style="width:220px">Ações</th>
        </tr>
      </thead>

      <tbody>
        <% if (!itens.length) { %>
          <tr><td colspan="6" class="muted">Sem peditórios registados.</td></tr>
        <% } %>

        <% itens.forEach(p => { const fid = `f-${p.id}`; %>
          <tr>
            <td data-label="Data">
              <input type="date" name="dt"
                     value="<%= (p.dt || '').slice(0,10) %>"
                     form="<%= fid %>">
            </td>
            <td data-label="Local">
              <input name="local" value="<%= p.local || '' %>" form="<%= fid %>">
            </td>
            <td data-label="Equipa">
              <input name="equipa" value="<%= p.equipa || '' %>" form="<%= fid %>">
            </td>
            <td data-label="Valor (€)">
              <input name="valor" inputmode="decimal" step="0.01"
                     value="<%= ((p.valor_cents||0)/100).toFixed(2) %>"
                     form="<%= fid %>">
            </td>
            <td data-label="Notas">
              <input name="notas" value="<%= p.notas || '' %>" form="<%= fid %>">
            </td>
            <td data-label="Ações" class="actions">
              <button class="btn" form="<%= fid %>">Guardar</button>
              <form method="post"
                    action="/peditorios/<%= p.id %>/delete"
                    onsubmit="return confirm('Apagar este peditório?')"
                    style="display:inline">
                <button class="btn btn-danger">Apagar</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>

      <tfoot>
        <tr>
          <th colspan="3" style="text-align:right">Total</th>
          <th>€ <%= (total_valor_cents/100).toFixed(2) %></th>
          <th colspan="2"></th>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<!-- Forms de update (fora da tabela) -->
<% itens.forEach(p => { const fid = `f-${p.id}`; %>
  <form id="<%= fid %>" method="post" action="/peditorios/<%= p.id %>"></form>
<% }) %>
